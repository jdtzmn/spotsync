webpackJsonp([1],{"/AuU":function(t,e){},"6XzT":function(t,e){},D4uH:function(t,e,i){"use strict";var s={},n={name:"icon",props:{name:{type:String,validator:function(t){return t?t in s||(console.warn('Invalid prop: prop "name" is referring to an unregistered icon "'+t+'".\nPlesase make sure you have imported this icon before using it.'),!1):(console.warn('Invalid prop: prop "name" is required.'),!1)}},scale:[Number,String],spin:Boolean,inverse:Boolean,pulse:Boolean,flip:{validator:function(t){return"horizontal"===t||"vertical"===t}},label:String},data:function(){return{x:!1,y:!1,childrenWidth:0,childrenHeight:0,outerScale:1}},computed:{normalizedScale:function(){var t=this.scale;return t=void 0===t?1:Number(t),isNaN(t)||t<=0?(console.warn('Invalid prop: prop "scale" should be a number over 0.',this),this.outerScale):t*this.outerScale},klass:function(){return{"fa-icon":!0,"fa-spin":this.spin,"fa-flip-horizontal":"horizontal"===this.flip,"fa-flip-vertical":"vertical"===this.flip,"fa-inverse":this.inverse,"fa-pulse":this.pulse}},icon:function(){return this.name?s[this.name]:null},box:function(){return this.icon?"0 0 "+this.icon.width+" "+this.icon.height:"0 0 "+this.width+" "+this.height},ratio:function(){if(!this.icon)return 1;var t=this.icon,e=t.width,i=t.height;return Math.max(e,i)/16},width:function(){return this.childrenWidth||this.icon&&this.icon.width/this.ratio*this.normalizedScale||0},height:function(){return this.childrenHeight||this.icon&&this.icon.height/this.ratio*this.normalizedScale||0},style:function(){return 1!==this.normalizedScale&&{fontSize:this.normalizedScale+"em"}},raw:function(){if(!this.icon||!this.icon.raw)return null;var t=this.icon.raw,e={};return t=t.replace(/\s(?:xml:)?id=["']?([^"')\s]+)/g,function(t,i){var s="fa-"+(a++).toString(16);return e[i]=s,' id="'+s+'"'}),t=t.replace(/#(?:([^'")\s]+)|xpointer\(id\((['"]?)([^')]+)\2\)\))/g,function(t,i,s,n){var a=i||n;return a&&e[a]?"#"+e[a]:t}),t}},mounted:function(){var t=this;if(!this.icon){this.$children.forEach(function(e){e.outerScale=t.normalizedScale});var e=0,i=0;this.$children.forEach(function(t){e=Math.max(e,t.width),i=Math.max(i,t.height)}),this.childrenWidth=e,this.childrenHeight=i,this.$children.forEach(function(t){t.x=(e-t.width)/2,t.y=(i-t.height)/2})}},register:function(t){for(var e in t){var i=t[e];i.paths||(i.paths=[]),i.d&&i.paths.push({d:i.d}),i.polygons||(i.polygons=[]),i.points&&i.polygons.push({points:i.points}),s[e]=i}},icons:s},a=870711,o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("svg",{class:t.klass,style:t.style,attrs:{version:"1.1",role:t.label?"img":"presentation","aria-label":t.label,x:t.x,y:t.y,width:t.width,height:t.height,viewBox:t.box}},[t._t("default",[t.icon&&t.icon.paths?t._l(t.icon.paths,function(e,s){return i("path",t._b({key:"path-"+s},"path",e,!1))}):t._e(),t._v(" "),t.icon&&t.icon.polygons?t._l(t.icon.polygons,function(e,s){return i("polygon",t._b({key:"polygon-"+s},"polygon",e,!1))}):t._e(),t._v("\b\n    "),t.icon&&t.icon.raw?[i("g",{domProps:{innerHTML:t._s(t.raw)}})]:t._e()])],2)},staticRenderFns:[]},r=i("VU/8")(n,o,!1,function(t){i("/AuU")},null,null);e.a=r.exports},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("7+uW"),n={render:function(){var t=this.$createElement,e=this._self._c||t;return e("el-container",{attrs:{id:"app"}},[e("el-header",{attrs:{id:"header"}},[e("div",{attrs:{id:"brand"}},[e("a",{staticClass:"name",attrs:{href:"/"}},[this._v("Spotsync")]),e("span",{staticClass:"beta"},[this._v("BETA")])]),e("div",{attrs:{id:"author"}},[e("span",[this._v("an app by")]),e("a",{staticClass:"link",attrs:{href:"https://github.com/jdtzmn",target:"_blank"}},[this._v("jdtzmn")])])]),e("el-main",{attrs:{id:"main"}},[e("router-view")],1)],1)},staticRenderFns:[]},a=i("VU/8")({name:"app"},n,!1,function(t){i("kxWh")},null,null).exports,o=i("/ocq"),r={name:"Home",data:function(){return{room:Math.random().toString(36).substr(2,5).toUpperCase(),url:window.location.origin+"/listen/",lastChanged:Date.now(),roomInUse:!1,accessToken:null,device_id:null,player:null,switchedToPlayer:!1,spotify:null,state:null}},created:function(){var t=document.createElement("script");t.setAttribute("src","//sdk.scdn.co/spotify-player.js"),document.head.appendChild(t),window.onSpotifyPlayerAPIReady=this.playerReady},methods:{playerReady:function(){var t=this,e=new window.Spotify.Player({name:"Spotsync",getOAuthToken:function(e){t.$axios.post("/auth/token").then(function(i){t.createSpotifyInstance(i.data),e(i.data)}).catch(function(e){404!==e.response.status&&403!==e.response.status||t.$router.push({path:"/login",query:{origin:window.location.pathname}})})}});e.on("initialization_error",function(e){return t.$message.error(e.message)}),e.on("authentication_error",function(e){"Authentication failed"===e.message?window.location.replace("/auth/login?origin="+window.location.pathname):t.$message.error(e.message)}),e.on("account_error",function(e){t.$alert("Spotify requires users to have premium.","Premium Required",{type:"error",showClose:!1,showConfirmButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1})}),e.on("playback_error",function(e){return t.$message.error(e.message)}),e.on("player_state_changed",function(e){e.timestamp=Date.now(),t.emitState(e),t.state=e}),e.on("ready",function(e){console.log("Ready with Device ID",e.device_id),t.device_id=e.device_id,t.switchToPlayer()}),e.connect(),this.player=e},createSpotifyInstance:function(t){this.accessToken=t,this.spotify=this.$axios.create({baseURL:"https://api.spotify.com/v1/",headers:{Authorization:"Bearer "+t}})},setupStream:function(){var t=this;this.$socket.emit("stream",this.room,function(e){t.roomInUse=!e})},switchToPlayer:function(){var t={device_ids:[this.device_id],play:!0};this.spotify.put("/me/player",t)},openSpotify:function(t){"web"===t?window.open("https://open.spotify.com"):window.location.replace("spotify:")},playDemo:function(){this.spotify.put("/me/player/play?device_id="+this.device_id,{uris:["spotify:track:4RXpgGM7A4Hg7cFBoH5KyF"]})},copySuccess:function(){this.$message.success("Link copied to clipboard")},emitState:function(t){t?this.state=t:t=this.state;var e={context:t.context,paused:t.paused,position:t.position+(Date.now()-t.timestamp),timestamp:Date.now(),track_window:t.track_window};this.$socket.emit("update",e)}},watch:{room:function(){this.setupStream()}},sockets:{connect:function(){this.setupStream()},request:function(){var t=this,e=Date.now();this.player.getCurrentState().then(function(i){i.position+=Date.now()-e,setTimeout(function(){return t.player.seek(i.position+1e3)},1e3)})},toomanyrequests:function(){this.$message.error("Too many requests. Please try again later.")},disconnect:function(){this.$alert("You are temporarily suspended","Too many requests",{type:"error",showClose:!1,showConfirmButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1})}}},c={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-row",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:!this.device_id,expression:"!this.device_id",modifiers:{fullscreen:!0,lock:!0}}]},[i("el-col",{attrs:{lg:{span:10,offset:7},sm:{span:14,offset:5},xs:{span:24}}},[i("h1",{staticClass:"header"},[t._v("Start streaming")]),i("el-card",{staticClass:"card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[t._v("Open Spotify")]),i("el-button",{staticClass:"copy",attrs:{type:"text"},on:{click:function(e){t.openSpotify("web")}}},[t._v("Open Web App")])],1),i("el-button",{staticClass:"open",attrs:{type:"success"},on:{click:t.openSpotify}},[i("icon",{staticClass:"icon",attrs:{name:"spotify",scale:"1.2"}}),i("span",{staticClass:"text"},[t._v("Open Spotify")])],1)],1),i("el-card",{staticClass:"card"},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v("Start playing a song")]),i("el-button",{attrs:{type:"primary",plain:"plain"},on:{click:t.playDemo}},[i("icon",{staticClass:"icon",attrs:{name:"music",scale:"1.2"}}),i("span",{staticClass:"text"},[t._v("Play a demo song")])],1)],1),i("el-card",{staticClass:"card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[t._v("Spread the love")]),i("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.url+t.room,expression:"url + room",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.copySuccess,expression:"copySuccess",arg:"success"}],staticClass:"copy",attrs:{type:"text"}},[t._v("Copy to clipboard")])],1),i("span",[t._v("Share this link with friends so they can listen with you")]),i("el-input",{staticClass:"link",attrs:{id:t.roomInUse?"invalid":void 0},model:{value:t.room,callback:function(e){t.room=e},expression:"room"}},[i("template",{slot:"prepend"},[t._v(t._s(t.url))])],2)],1)],1)],1)},staticRenderFns:[]},l=i("VU/8")(r,c,!1,function(t){i("Nvb5"),i("ThsU")},"data-v-6ba05af6",null).exports,u={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"card"},[e("h1",{staticClass:"header"},[this._v("To continue... please login with Spotify")]),e("a",{staticClass:"link",attrs:{href:"/auth/login"}},[e("el-button",{staticClass:"login",attrs:{type:"success"}},[e("icon",{staticClass:"icon",attrs:{name:"spotify",scale:"1.2"}}),e("span",{staticClass:"text"},[this._v("Login with Spotify")])],1)],1)])},staticRenderFns:[]},h=i("VU/8")({name:"Login"},u,!1,function(t){i("6XzT")},"data-v-b4fae5e0",null).exports,p={name:"Listen",data:function(){return{track:{name:"Track Name",uri:"",image:"",artists:"Artist",position:0,paused:!1,timestamp:Date.now()},offset:{list:[],amount:null},timeout:null,device_id:null,player:null,spotify:null}},created:function(){var t=document.createElement("script");t.setAttribute("src","//sdk.scdn.co/spotify-player.js"),document.head.appendChild(t),window.onSpotifyPlayerAPIReady=this.playerReady},methods:{playerReady:function(){var t=this,e=new window.Spotify.Player({name:"Spotsync",getOAuthToken:function(e){t.$axios.post("/auth/token").then(function(i){t.createSpotifyInstance(i.data),e(i.data)}).catch(function(e){404!==e.response.status&&403!==e.response.status||t.$router.push({path:"/login",query:{origin:window.location.pathname}})})}});e.on("initialization_error",function(e){return t.$message.error(e.message)}),e.on("authentication_error",function(e){"Authentication failed"===e.message?window.location.replace("/auth/login?origin="+window.location.pathname):t.$message.error(e.message)}),e.on("account_error",function(e){t.$alert("Spotify requires users to have premium.","Premium Required",{type:"error",showClose:!1,showConfirmButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1})}),e.on("playback_error",function(e){return t.$message.error(e.message)}),e.on("ready",function(e){console.log("Ready with Device ID",e.device_id),t.device_id=e.device_id,t.$socket.emit("listen",t.$route.params.room,function(e){e||t.$router.push("/notfound")})}),e.connect(),this.player=e},createSpotifyInstance:function(t){this.accessToken=t,this.spotify=this.$axios.create({baseURL:"https://api.spotify.com/v1/",headers:{Authorization:"Bearer "+t}})},sync:function(){var t=this;this.offset.amount?this.player.seek(this.track.position+Date.now()-this.track.timestamp+this.offset.amount).then(function(){return t.player.getCurrentState().then(function(e){if(e){var i=t.track.position+Date.now()-t.track.timestamp,s=e.position-i;t.player.seek(e.position-s+t.offset.amount)}else t.sync()})}):this.calculateOffset()},calculateOffset:function(){var t=this,e=this.offset.list[this.offset.list.length-1]||0;this.player.seek(this.track.position+Date.now()-this.track.timestamp).then(function(){return t.player.getCurrentState().then(function(i){if(i){var s=t.track.position+Date.now()-t.track.timestamp,n=i.position-s;t.offset.list.push(-n),Math.abs(n)<Math.abs(e)/3&&(t.offset.list=[-n]),4===t.offset.list.length&&(t.offset.amount=t.offset.list.reduce(function(t,e){return t+e})/4),console.log(t.offset.amount),console.log(t.offset.list),setTimeout(t.resync,Math.max(Math.min(Math.abs(e),1500),100))}else t.calculateOffset()})})},resync:function(){var t=this;this.$socket.emit("request",function(e){e?(t.$message.error("Too many requests. You will be synced in 7 seconds automatically."),t.timeout||(t.timeout=setTimeout(t.resync,7e3))):t.timeout&&(t.timeout=null)})}},sockets:{update:function(t){if(t.paused)this.player.pause(),this.track.paused=!0;else{var e=this.track.uri===t.track_window.current_track.uri;this.track.name=t.track_window.current_track.name,this.track.artists=t.track_window.current_track.artists.map(function(t){return t.name}).join(", "),this.track.image=t.track_window.current_track.album.images[0].url,this.track.uri=t.track_window.current_track.uri,this.track.position=t.position,this.track.timestamp=Date.now(),this.track.paused&&(this.player.resume(),this.track.paused=!1),e?this.sync():this.spotify.put("/me/player/play?device_id="+this.device_id,{uris:[this.track.uri]}).then(this.sync)}},toomanyrequests:function(){this.$message.error("Too many requests. Please try again later.")},disconnect:function(){this.$alert("You are temporarily suspended","Too many requests",{type:"error",showClose:!1,showConfirmButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1})}}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("el-row",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:!this.device_id,expression:"!this.device_id",modifiers:{fullscreen:!0,lock:!0}}]},[e("el-col",{staticClass:"main",attrs:{md:{span:10,offset:7},sm:{span:18,offset:6},xs:{span:22,offset:1}}},[e("h1",{staticClass:"header"},[this._v("Currently listening to")]),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{sm:6,xs:8}},[e("img",{staticClass:"img",attrs:{src:this.track.image,width:"100%"}})]),e("el-col",{attrs:{sm:18,xs:16}},[e("div",{staticClass:"name"},[this._v(this._s(this.track.name))]),e("div",{staticClass:"artist"},[this._v(this._s(this.track.artists))])])],1),this.track.uri?e("el-button",{staticClass:"resync",attrs:{type:"warning",plain:"plain",round:"round"},on:{click:this.resync}},[this._v("Out of sync? Click here.")]):this._e()],1)],1)},staticRenderFns:[]},f=i("VU/8")(p,d,!1,function(t){i("Sk93")},"data-v-266c4b70",null).exports,m={render:function(){var t=this.$createElement,e=this._self._c||t;return e("el-row",[e("el-col",{staticClass:"main",attrs:{md:{span:10,offset:7},sm:{span:12,offset:6},xs:{span:22,offset:1}}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("icon",{staticClass:"icon-stack",attrs:{label:"No Music",scale:"4"}},[e("icon",{staticClass:"icon-headphones",attrs:{name:"volume-up"}}),e("icon",{staticClass:"icon-ban",attrs:{name:"ban",scale:"2"}})],1)],1),e("el-col",{attrs:{span:18}},[e("h1",{staticClass:"title"},[this._v("Can't hear anything?")]),e("p",{staticClass:"subtitle"},[this._v("We think you may have entered the link incorrectly...")])])],1)],1)],1)},staticRenderFns:[]},y=i("VU/8")({name:"NotFound"},m,!1,function(t){i("bLcV")},"data-v-184e1114",null).exports;s.default.use(o.a);var v=new o.a({mode:"history",routes:[{path:"/",name:"Home",component:l},{path:"/login",name:"Login",component:h},{path:"/listen/:room",name:"Listen",component:f},{path:"/notfound",name:"NotFound",component:y},{path:"*",redirect:"/"}]}),g=i("zL8q"),w=i.n(g),k=(i("tvR6"),i("D4uH")),_=(i("D/PP"),i("wvfG")),b=i.n(_),C=i("hMcO"),S=i.n(C),x=i("mtWM"),$=i.n(x);s.default.use(w.a),s.default.component("icon",k.a),s.default.use(b.a),s.default.use(S.a,"/"),Object.defineProperty(s.default.prototype,"$axios",{value:$.a}),s.default.config.productionTip=!1,new s.default({el:"#app",router:v,template:"<App/>",components:{App:a}})},Nvb5:function(t,e){},Sk93:function(t,e){},ThsU:function(t,e){},bLcV:function(t,e){},kxWh:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.3a0e007cad8d80d9e75c.js.map