var spotify;interval=null,$(document).ready(function(){$(".fa-play").click(function(){if($(".fa-play").hasClass("fa-pause")&&($(".fa-play").removeClass("fa-pause"),player.mute=!0),$(".fa-play").hasClass("fa-microphone")){if($(".fa-microphone").hasClass("bounce"))$(".fa-microphone").removeClass("bounce infinite");else if($(".fa-stack").hasClass("text-danger"))return clearInterval(interval),$(".fa-stack").removeClass("text-danger"),$(".fa-microphone").addClass("fa-microphone-slash"),void(player.mute=!0);$(".fa-microphone-slash").removeClass("fa-microphone-slash"),$(".fa-stack").addClass("text-danger"),$(".fa-stack").fadeOut().delay(100).fadeIn(),player.mute=!1,clearInterval(interval),interval=setInterval(function(){$(".fa-stack").fadeOut().delay(100).fadeIn()},3e3)}else $(".fa-play").addClass("fa-pause"),player.mute=!1,socket.emit("status")}),$("#csrf").keyup(function(){var a=$("#csrf").val();Spotify.start(a,function(e,s,t){e?(window.localStorage.setItem("csrf",a),document.location.reload(!0)):$("#csrf").parent().parent().addClass("has-error")})})});
function Timer(){var t,e;this.start=function(n){n&&"number"==typeof n?t=n:(e=new Date,t=e.getTime())},this.stop=function(){return e=new Date,e.getTime()-t}}var difference=function(t,e){return Math.abs(t-e)};
var player={format:function(t){return Math.floor(t/60)+":"+"0".substring(0,2-JSON.stringify(t%60).length)+t%60},play:function(t,e){if(!player.mute)if("function"==typeof t&&(e=t),$(".fa-stack").hasClass("text-danger"))spotify.status(1).done(function(t){var e=new Date;t.time=e.getTime(),socket.emit("play",t)});else{var i=new Timer;i.start(t.time),spotify.status(1).done(function(o){if(delay=i.stop()/1e3,console.log("difference:"+difference(t.playing_position+delay,o.playing_position)),o.playing&&difference(t.playing_position+delay,o.playing_position)>.25)spotify.togglePause().done(function(o){if(t.playing){var n=t.track.track_resource.uri+"#"+player.format(Math.round(t.playing_position+i.stop()/1e3));spotify.play(n).done(function(t){socket.emit("status"),e(t)})}});else if(t.playing&&difference(t.playing_position+delay,o.playing_position)>.1){var n=t.track.track_resource.uri+"#"+player.format(Math.round(t.playing_position+i.stop()/1e3));spotify.play(n).done(function(t){socket.emit("status"),e(t)})}else socket.emit("status")})}},mute:!0};
var socket=io.connect("/");socket.emit("room",window.location.pathname.substr(1)),socket.on("first",function(){$(".fa-play").addClass("fa-microphone animated infinite bounce")}),socket.on("play",function(t){player.play(t,function(){})}),socket.on("status",function(){spotify.status(1).done(function(t){var o=new Date;t.time=o.getTime(),socket.emit("play",t)})});
var spotify;$(document).ready(function(){$(".csrf").fadeIn(),null!==window.localStorage.getItem("csrf")&&Spotify.start(window.localStorage.getItem("csrf"),function(t,e,f){t&&(spotify=e,$(".csrf").fadeOut(),setTimeout(function(){$(".fa-stack").hide().fadeIn(),$(".csrf").hide()},400))})});
//# sourceMappingURL=scripts.min.js.map
