{"version":3,"sources":["js/button.js","js/functions.js","js/player.js","js/socket.js","js/spotify.js"],"names":["spotify","interval","$","document","ready","click","hasClass","removeClass","player","mute","clearInterval","addClass","fadeOut","delay","fadeIn","setInterval","socket","emit","keyup","value","val","Spotify","start","ok","instance","msg","window","localStorage","setItem","location","reload","parent","Timer","begin","d","this","num","Date","getTime","stop","difference","a","b","Math","abs","format","floor","substring","JSON","stringify","length","play","track","cb","status","done","date","time","timer","console","log","playing_position","playing","togglePause","uri","track_resource","round","io","connect","pathname","substr","on","getItem","setTimeout","hide"],"mappings":"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","file":"scripts.min.js","sourcesContent":["var spotify;\ninterval = null;\n$(document).ready(function() {\n  $('.fa-play').click(function() {\n    if ($('.fa-play').hasClass('fa-pause')) {\n      $('.fa-play').removeClass('fa-pause');\n      player.mute = true;\n    }\n\n    if ($('.fa-play').hasClass('fa-microphone')) {\n      if ($('.fa-microphone').hasClass('bounce')) {\n        $('.fa-microphone').removeClass('bounce infinite');\n      } else if ($('.fa-stack').hasClass('text-danger')) {\n        clearInterval(interval);\n        $('.fa-stack').removeClass('text-danger');\n        $('.fa-microphone').addClass('fa-microphone-slash');\n        player.mute = true;\n        return;\n      }\n\n      $('.fa-microphone-slash').removeClass('fa-microphone-slash');\n      $('.fa-stack').addClass('text-danger');\n      $('.fa-stack').fadeOut().delay(100).fadeIn();\n      player.mute = false;\n\n      clearInterval(interval);\n      interval = setInterval(function() {\n        $('.fa-stack').fadeOut().delay(100).fadeIn();\n      }, 3000);\n    } else {\n      $('.fa-play').addClass('fa-pause');\n      player.mute = false;\n      socket.emit('status');\n    }\n  });\n\n  $('#csrf').keyup(function() {\n    var value = $('#csrf').val();\n    Spotify.start(value, function(ok, instance, msg) {\n      if (ok) {\n        window.localStorage.setItem('csrf', value);\n        document.location.reload(true);\n      } else {\n        $('#csrf').parent().parent().addClass('has-error');\n      }\n    });\n  });\n});\n","function Timer() {\n  var begin, d;\n\n  this.start = function(num) {\n    if (num && typeof num === 'number') {\n      begin = num;\n    } else {\n      d = new Date();\n      begin = d.getTime();\n    }\n  };\n\n  this.stop = function() {\n    d = new Date();\n    return d.getTime() - begin;\n  };\n}\n\nvar difference = function(a, b) {\n  return Math.abs(a - b);\n};\n","var player = {\n  format: function(num) {\n    return Math.floor(num / 60) + ':' + '0'.substring(0, 2 - JSON.stringify(num % 60).length) + num % 60;\n  },\n  play: function(track, cb) {\n    if (!player.mute) {\n      if (typeof track === 'function') {\n        cb = track;\n      }\n\n      if ($('.fa-stack').hasClass('text-danger')) {\n        spotify.status(1).done(function(d) {\n          var date = new Date();\n          d.time = date.getTime();\n    \t\t\tsocket.emit('play', d);\n    \t\t});\n      } else {\n        var timer = new Timer();\n        timer.start(track.time);\n        spotify.status(1).done(function(d) {\n          delay = timer.stop() / 1000;\n          console.log('difference:' + difference((track.playing_position + delay), d.playing_position));\n          if (d.playing  && difference(track.playing_position + delay, d.playing_position) > 0.25) {\n            spotify.togglePause().done(function(d) {\n              if (track.playing) {\n                var uri = track.track.track_resource.uri + '#' + player.format(Math.round(track.playing_position + (timer.stop() / 1000)));\n                spotify.play(uri).done(function(d) {\n                  socket.emit('status');\n                  cb(d);\n                });\n              }\n            });\n          } else {\n            if (track.playing && difference(track.playing_position + delay, d.playing_position) > 0.1) {\n              var uri = track.track.track_resource.uri + '#' + player.format(Math.round(track.playing_position + (timer.stop() / 1000)));\n              spotify.play(uri).done(function(d) {\n                socket.emit('status');\n                cb(d);\n              });\n            } else {\n              socket.emit('status');\n            }\n          }\n        });\n      }\n    }\n  },\n  mute: true\n};\n","var socket = io.connect('/');\n\nsocket.emit('room', window.location.pathname.substr(1));\n\nsocket.on('first', function() {\n  $('.fa-play').addClass('fa-microphone animated infinite bounce');\n});\n\nsocket.on('play', function(d) {\n  player.play(d, function() {\n    \n  });\n});\n\nsocket.on('status', function() {\n  spotify.status(1).done(function(d) {\n    var date = new Date();\n    d.time = date.getTime();\n    socket.emit('play', d);\n  });\n});\n","var spotify;\n$(document).ready(function() {\n  $('.csrf').fadeIn();\n  if (window.localStorage.getItem('csrf') !== null) {\n    Spotify.start(window.localStorage.getItem('csrf'), function(ok, instance, msg) {\n      if (ok) {\n        spotify = instance;\n        $('.csrf').fadeOut();\n        setTimeout(function() {\n          $('.fa-stack').hide().fadeIn();\n          $('.csrf').hide();\n        }, 400);\n      }\n    });\n  }\n});\n"],"sourceRoot":"/source/"}